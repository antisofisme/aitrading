// Flow-aware middleware integration for api-gateway
// Auto-generated by ServiceIntegration

const { ServiceIntegration } = require('../../shared/middleware/flow-aware');

// Initialize service integration
const serviceIntegration = new ServiceIntegration({
  logger: require('../utils/logger'), // Use existing logger
  middlewareConfig: {
    flowTracker: {
      enabled: true,
      performanceThreshold: 1,
      enableDependencyTracking: true
    },
    chainContext: {
      enabled: true,
      enablePersistence: true
    },
    metricsCollector: {
      enabled: true,
      enableRealTimeMetrics: true
    },
    eventPublisher: {
      enabled: true,
      enableBuffering: true
    }
  }
});

// Initialize integration
serviceIntegration.initialize().catch(console.error);

// Get service configuration
const serviceConfig = serviceIntegration.createServiceConfig('api-gateway');

// Export middleware stack
module.exports = {
  middlewareStack: serviceIntegration.getMiddlewareStack(),
  serviceConfig,
  integration: serviceConfig.integration,

  // Helper functions
  getFlowContext: serviceConfig.integration.getFlowContext,
  getChainContext: serviceConfig.integration.getChainContext,
  trackDependency: serviceConfig.integration.trackDependency,
  addError: serviceConfig.integration.addError,
  getOutgoingHeaders: serviceConfig.integration.getOutgoingHeaders
};